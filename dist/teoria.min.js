!function(){"use strict";function t(t,n){return[t[0]+n[0],t[1]+n[1]]}function n(t,n){return[t[0]-n[0],t[1]-n[1]]}function e(t,n){return"number"==typeof n?[t[0]*n,t[1]*n]:[t[0]*n[0],t[1]*n[1]]}function i(t){return t[0]+t[1]}function r(t,n,e){for(;e>0;e--)t+=n;return t}function o(t,n){n=n||{},this.duration={value:n.value||4,dots:n.dots||0},this.coord=t}function a(t){this.coord=t}function s(t,n){function e(t){for(var n=0,e=t.length;e>n;n++)d[n+1]=t[n];f=t.length}n=n||"",this.name=t.name().toUpperCase()+t.accidental()+n,this.symbol=n,this.root=t,this.intervals=[],this._voicing=[];var i,r,o,a,s,h,u="quality",l=[],d=["P1","M3","P5","m7","M9","P11","M13"],f=2;for(n=n.replace(/[,\s\(\)]/g,""),s=n.split("/"),2===s.length?(n=s[0],s=s[1]):s=null,i=0,r=n.length;r>i&&(o=n[i]);i++){switch(u){case"quality":a=r>=i+3?n.substr(i,3).toLowerCase():null,h=a in y?a:o in y?o:"",e(y[h]),i+=h.length-1,u="extension";break;case"extension":if(o=parseFloat("1"===o&&n[i+1]?n.substr(i,2):o),isNaN(o)||6===o)6===o?(d[3]="M6",f=3>f?3:f):i-=1;else{if(f=(o-1)/2,f!==Math.round(f))throw new Error("Invalid interval extension: "+o.toString(10));("o"===h||"dim"===h)&&(d[3]="d7"),i+=String(o).length-1}u="alterations";break;case"alterations":var m,v=n.substr(i).split(/(#|b|add|maj|sus|M)/i),p=!1,g=!1;if(1===v.length)throw new Error("Invalid alterations");if(0!==v[0].length)throw new Error("Invalid token: '"+v[0]+"'");for(var w=1,M=v.length;M>w;w++)switch(m=v[w+1],v[w]){case"M":case"Maj":case"maj":f=3>f?3:f,"7"===m&&w++,d[3]="M7";break;case"Sus":case"sus":var b="P4";("2"===m||"4"===m)&&(w++,"2"===m&&(b="M2")),d[1]=b;break;case"Add":case"add":m&&!isNaN(+m)&&("9"===m?l.push("M9"):"11"===m?l.push("P11"):"13"===m&&l.push("M13"),w+=m.length);break;case"b":p=!0;break;case"#":g=!0;break;default:if(0===v[w].length)break;var P,A,x=+v[w];if(isNaN(x)||String(x).length!==v[w].length)throw new Error("Invalid token: '"+v[w]+"'");if(6===x){d[3]=g?"A6":p?"m6":"M6",f=3>f?3:f;continue}if(A=(x-1)/2,A>f&&(f=A),5>x||7===x||A!==Math.round(A))throw new Error("Invalid interval alteration: "+x);P=d[A][0],g?"d"===P?P="m":"m"===P?P="M":("M"===P||"P"===P)&&(P="A"):p&&("A"===P?P="M":"M"===P?P="m":("m"===P||"P"===P)&&(P="d")),g=p=!1,d[A]=P+x}u="ended"}if("ended"===u)break}for(s&&"9"===s&&(l.push("M9"),s=null),this.intervals=d.slice(0,f+1).concat(l).map(function(t){return c.interval(t)}),i=0,r=this.intervals.length;r>i;i++)this._voicing[i]=this.intervals[i];if(s){var S,q,k=this.intervals;for(q=c.note(s+(t.octave()+1)),S=c.interval.between(t,q),s=S.simple(),S=S.invert(),S.direction("down"),this._voicing=[S],i=0;r>i;i++)k[i].simple().equal(s)||this._voicing.push(k[i])}}function h(t,n){var e,i;if(!(t instanceof o))throw new Error("Invalid Tonic");if("string"==typeof n){if(e=n,n=c.scale.scales[n],!n)throw new Error("Invalid Scale")}else for(i in c.scale.scales)if(c.scale.scales.hasOwnProperty(i)&&c.scale.scales[i].toString()===n.toString()){e=i;break}this.name=e,this.tonic=t,this.scale=n}var c={},u={c:[0,0],d:[-1,2],e:[-2,4],f:[1,-1],g:[0,1],a:[-1,3],b:[-2,5],h:[-2,5]},l={unison:[0,0],second:[3,-5],third:[2,-3],fourth:[1,-1],fifth:[0,1],sixth:[3,-4],seventh:[2,-2],octave:[1,0]},d=["second","sixth","third","seventh","fourth","unison","fifth"],f=["unison","second","third","fourth","fifth","sixth","seventh","octave","ninth","tenth","eleventh","twelfth","thirteenth","fourteenth","fifteenth"],m=["f","c","g","d","a","e","b"],v=["bb","b","","#","x"],p=[-4,7],g=t(u.a,[4,0]),w={.25:"longa",.5:"breve",1:"whole",2:"half",4:"quarter",8:"eighth",16:"sixteenth",32:"thirty-second",64:"sixty-fourth",128:"hundred-twenty-eighth"},M={P:"perfect",M:"major",m:"minor",A:"augmented",AA:"doubly augmented",d:"diminished",dd:"doubly diminished"},b={perfect:["dd","d","P","A","AA"],minor:["dd","d","m","M","A","AA"]},y={min:["m3","P5"],m:["m3","P5"],"-":["m3","P5"],M:["M3","P5"],"":["M3","P5"],"+":["M3","A5"],aug:["M3","A5"],dim:["m3","d5"],o:["m3","d5"],maj:["M3","P5","M7"],dom:["M3","P5","m7"],"Ã¸":["m3","d5","m7"],5:["P5"]},P={major:"M",minor:"m",augmented:"aug",diminished:"dim","half-diminished":"7b5",power:"5",dominant:"7"},A={unison:1,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,octave:8,ninth:9,eleventh:11,thirteenth:13},x={dd1:"daw",d1:"de",P1:"do",A1:"di",AA1:"dai",d2:"raw",m2:"ra",M2:"re",A2:"ri",AA2:"rai",d3:"maw",m3:"me",M3:"mi",A3:"mai",dd4:"faw",d4:"fe",P4:"fa",A4:"fi",AA4:"fai",dd5:"saw",d5:"se",P5:"so",A5:"si",AA5:"sai",d6:"law",m6:"le",M6:"la",A6:"li",AA6:"lai",d7:"taw",m7:"te",M7:"ti",A7:"tai",dd8:"daw",d8:"de",P8:"do",A8:"di",AA8:"dai"};c.note=function(t,n){return"string"==typeof t?c.note.fromString(t,n):new o(t,n)},c.note.fromKey=function(r){var o=Math.floor((r-4)/12),a=r-12*o-4,s=m[(2*Math.round(a/2)+1)%7],h=t(n(u[s],g),[o+1,0]),l=r-49-i(e(h,[12,7]));return c.note(l?t(h,e(p,l)):h)},c.note.fromFrequency=function(t,n){var e,i,r;return n=n||440,e=49+12*((Math.log(t)-Math.log(n))/Math.log(2)),e=Math.round(e),r=n*Math.pow(2,(e-49)/12),i=1200*(Math.log(t/r)/Math.log(2)),{note:c.note.fromKey(e),cents:i}},c.note.fromMIDI=function(t){return c.note.fromKey(t-20)},c.note.fromString=function(i,r){var a,s,h,c,l,d,f=/^([a-h])(x|#|bb|b?)(-?\d*)/i,m=/^([a-h])(x|#|bb|b?)([,\']*)$/i;if(a=i.match(f),a&&i===a[0]&&a[3].length)s=a[1],h=+a[3];else{if(i=i.replace(/\u2032/g,"'").replace(/\u0375/g,","),a=i.match(m),!a||i!==a[0])throw new Error("Invalid note format");if(s=a[1],h=a[3],d=s===s.toLowerCase(),h.length)if(h.match(/^'+$/)&&d)h=3+h.length;else{if(!h.match(/^,+$/)||d)throw new Error("Format must respect the Helmholtz format");h=2-h.length}else h=d?3:2}return c=a[2].length?a[2].toLowerCase():"",s=s.toLowerCase(),l=[u[s][0],u[s][1]],l=t(l,[h,0]),l=t(l,e(p,v.indexOf(c)-2)),new o(n(l,g),r)},c.chord=function(t,n){if("string"==typeof t){var e,i;if(e=t.match(/^([a-h])(x|#|bb|b?)/i),e&&e[0])return i="number"==typeof n?n.toString(10):"4",new s(c.note(e[0].toLowerCase()+i),t.substr(e[0].length))}else if(t instanceof o)return new s(t,n);throw new Error("Invalid Chord. Couldn't find note name")},c.interval=function(t,n){if("string"==typeof t)return c.interval.toCoord(t);if("string"==typeof n&&t instanceof o)return c.interval.from(t,c.interval.toCoord(n));if(n instanceof a&&t instanceof o)return c.interval.from(t,n);if(n instanceof o&&t instanceof o)return c.interval.between(t,n);throw new Error("Invalid parameters")},c.interval.toCoord=function(n){var i,r,o,s,h,c,u,d,m,v,g=/^(AA|A|P|M|m|d|dd)(-?\d+)$/;if(i=n.match(g),!i)throw new Error("Invalid simple format interval");if(s=i[1],r=+i[2],v=0>r,r=v?-r:r,h=r>8?r%7?r%7:7:r,c=(r-h)/7,u=l[f[h-1]],o=t(u,[c,0]),d=u[0]<=1?"perfect":"minor","perfect"===d&&("M"===s||"m"===s)||"minor"===d&&"P"===s)throw new Error("Invalid interval quality");return m=b[d].indexOf(s)-2,o=t(o,e(p,m)),o=v?e(o,-1):o,new a(o)},c.interval.from=function(n,e){return new o(t(n.coord,e.coord))},c.interval.between=function(t,e){return new a(n(e.coord,t.coord))},c.interval.invert=function(t){return c.interval(t).invert().toString()},c.scale=function(t,n){return t instanceof o||(t=c.note(t)),new h(t,n)},c.scale.scales={},o.prototype={octave:function(){return this.coord[0]+g[0]-u[this.name()][0]+4*this.accidentalValue()},name:function(){return m[this.coord[1]+g[1]-7*this.accidentalValue()+1]},accidentalValue:function(){return Math.round((this.coord[1]+g[1]-2)/7)},accidental:function(){return v[this.accidentalValue()+2]},key:function(t){return t?7*this.coord[0]+4*this.coord[1]+29:12*this.coord[0]+7*this.coord[1]+49},fq:function(t){return t=t||440,t*Math.pow(2,(12*this.coord[0]+7*this.coord[1])/12)},chroma:function(){var t=(i(e(this.coord,[12,7]))-3)%12;return 0>t?t+12:t},scale:function(t){return c.scale(this,t)},interval:function(t){return c.interval(this,t)},transpose:function(t){var n=c.interval(this,t);return this.coord=n.coord,this},chord:function(t){return t=t in P?P[t]:t,new s(this,t)},helmholtz:function(){var t=this.octave(),n=this.name();n=3>t?n.toUpperCase():n.toLowerCase();var e=3>t?",":"'",i=2>t?2-t:t-3;return r(n+this.accidental(),e,i)},scientific:function(){return this.name().toUpperCase()+this.accidental()+this.octave()},enharmonics:function(n){var i=this.key(),r=n?2:3;return["m3","m2","m-2","m-3"].map(this.interval.bind(this)).filter(function(n){var o=n.accidentalValue(),a=i-(n.key()-o);return r>a&&a>-r?(n.coord=t(n.coord,e(p,a-o)),!0):void 0})},solfege:function(t,n){if(!(t instanceof h))throw new Error("Invalid Scale");var e,i,o,a=t.tonic.interval(this);return"down"===a.direction()&&(a=a.invert()),n&&(o=(this.key(!0)-t.tonic.key(!0))/7,o=o>=0?Math.floor(o):-Math.ceil(-o),i=o>=0?"'":","),e=x[a.simple(!0).toString()],n?r(e,i,Math.abs(o)):e},durationName:function(){return w[this.duration.value]},durationInSeconds:function(t,n){var e=60/t/(this.duration.value/4)/(n/4);return 2*e-e/Math.pow(2,this.duration.dots)},scaleDegree:function(t){var n=t.tonic.interval(this);return("down"===n.direction()||0===n.coord[1]&&0!==n.coord[0])&&(n=n.invert()),n=n.simple(!0).coord,t.scale.reduce(function(t,e,i){var r=c.interval(e).coord;return r[0]===n[0]&&r[1]===n[1]?i+1:t},0)},toString:function(t){return this.name()+this.accidental()+(t?"":this.octave())}},a.prototype={name:function(){return f[this.number()-1]},semitones:function(){return i(e(this.coord,[12,7]))},number:function(){return Math.abs(this.value())},value:function(){var t,i,r=n(this.coord,e(p,Math.floor((this.coord[1]-2)/7)+1));return t=d[r[1]+5],i=A[t]+7*(r[0]-l[t][0]),i>0?i:i-2},type:function(){return l[this.base()][0]<=1?"perfect":"minor"},base:function(){var t,i=n(this.coord,e(p,this.qualityValue()))[1];return i=this.value()>0?i+5:-(i-5)%7,i=0>i?d.length+i:i,t=d[i],"unison"===t&&this.number()>=8&&(t="octave"),t},direction:function(t){if(t){var n=this.value()>=1?"up":"down";return n!==t&&(this.coord=e(this.coord,-1)),this}return this.value()>=1?"up":"down"},simple:function(n){var i=l[this.base()];return i=t(i,e(p,this.qualityValue())),n||(i="down"===this.direction()?e(i,-1):i),new a(i)},isCompound:function(){return this.number()>8},octaves:function(){var t,i;return"up"===this.direction()?(t=n(this.coord,e(p,this.qualityValue())),i=t[0]-l[this.base()][0]):(t=n(this.coord,e(p,-this.qualityValue())),i=-(t[0]+l[this.base()][0])),i},invert:function(){var n=this.base(),i=this.qualityValue(),r="minor"===this.type()?-(i-1):-i,o=l[f[9-A[n]-1]];return o=t(o,e(p,r)),new a(o)},quality:function(t){var n=b[this.type()][this.qualityValue()+2];return t?M[n]:n},qualityValue:function(){return"down"===this.direction()?Math.floor((-this.coord[1]-2)/7)+1:Math.floor((this.coord[1]-2)/7)+1},equal:function(t){return this.coord[0]===t.coord[0]&&this.coord[1]===t.coord[1]},greater:function(t){var n=this.semitones(),e=t.semitones();return n===e?this.number()>t.number():n>e},smaller:function(t){return!this.equal(t)&&!this.greater(t)},add:function(n){return new a(t(this.coord,n.coord))},toString:function(t){var n=t?this.number():this.value();return this.quality()+n}},s.prototype={notes:function(){for(var t=this.voicing(),n=[],e=0,i=t.length;i>e;e++)n.push(c.interval.from(this.root,t[e]));return n},voicing:function(t){if(!t)return this._voicing;this._voicing=[];for(var n=0,e=t.length;e>n;n++)this._voicing[n]=c.interval(t[n]);return this},resetVoicing:function(){this._voicing=this.intervals},dominant:function(t){return t=t||"",new s(this.root.interval("P5"),t)},subdominant:function(t){return t=t||"",new s(this.root.interval("P4"),t)},parallel:function(t){t=t||"";var n=this.quality();if("triad"!==this.chordType()||"diminished"===n||"augmented"===n)throw new Error("Only major/minor triads have parallel chords");return"major"===n?new s(this.root.interval("m3","down"),"m"):new s(this.root.interval("m3","up"))},quality:function(){for(var t,n,e,i=this.intervals,r=0,o=i.length;o>r;r++)3===i[r].number()?t=i[r]:5===i[r].number()?n=i[r]:7===i[r].number()&&(e=i[r]);return t?(t="down"===t.direction()?t.invert():t,t=t.simple().toString(),n&&(n="down"===n.direction?n.invert():n,n=n.simple().toString()),e&&(e="down"===e.direction?e.invert():e,e=e.simple().toString()),"M3"===t?"A5"===n?"augmented":"P5"===n&&"m7"===e?"dominant":"major":"m3"===t?"P5"===n?"minor":"d5"===n?"m7"===e?"half-diminished":"diminished":"minor":void 0):void 0},chordType:function(){var t,n,e,i,r,o=this.intervals.length;if(2===o)return"dyad";if(3===o){for(n={first:!1,third:!1,fifth:!1},i=0;o>i;i++)t=this.intervals[i],e=t.invert(),t.base()in n?n[t.base()]=!0:e.base()in n&&(n[e.base()]=!0);r=n.first&&n.third&&n.fifth?"triad":"trichord"}else if(4===o){for(n={first:!1,third:!1,fifth:!1,seventh:!1},i=0;o>i;i++)t=this.intervals[i],e=t.invert(),t.base()in n?n[t.base()]=!0:e.base()in n&&(n[e.base()]=!0);n.first&&n.third&&n.fifth&&n.seventh&&(r="tetrad")}return r||"unknown"},get:function(t){if("string"==typeof t&&t in A){var n,e,i=this.intervals;for(t=A[t],n=0,e=i.length;e>n;n++)if(i[n].number()===t)return c.interval.from(this.root,i[n]);return null}throw new Error("Invalid interval name")},interval:function(t){return new s(this.root.interval(t),this.symbol)},transpose:function(t){return this.root.transpose(t),this.name=this.root.name().toUpperCase()+this.root.accidental()+this.symbol,this},toString:function(){return this.name}},h.prototype={notes:function(){for(var t=[],n=0,e=this.scale.length;e>n;n++)t.push(c.interval(this.tonic,this.scale[n]));return t},simple:function(){return this.notes().map(function(t){return t.toString(!0)})},type:function(){var t=this.scale.length-2;return 8>t?["di","tri","tetra","penta","hexa","hepta","octa"][t]+"tonic":void 0},get:function(t){return t="string"==typeof t&&t in A?A[t]:t,this.tonic.interval(this.scale[t-1])},solfege:function(t,n){return t?this.get(t).solfege(this,n):this.notes().map(function(t){return t.solfege(this,n)})},interval:function(t){return new h(this.tonic.interval(t),this.scale)},transpose:function(t){var n=this.interval(t);return this.scale=n.scale,this.tonic=n.tonic,this}},c.scale.scales.ionian=c.scale.scales.major=["P1","M2","M3","P4","P5","M6","M7"],c.scale.scales.dorian=["P1","M2","m3","P4","P5","M6","m7"],c.scale.scales.phrygian=["P1","m2","m3","P4","P5","m6","m7"],c.scale.scales.lydian=["P1","M2","M3","A4","P5","M6","M7"],c.scale.scales.mixolydian=["P1","M2","M3","P4","P5","M6","m7"],c.scale.scales.aeolian=c.scale.scales.minor=["P1","M2","m3","P4","P5","m6","m7"],c.scale.scales.locrian=["P1","m2","m3","P4","d5","m6","m7"],c.scale.scales.majorpentatonic=["P1","M2","M3","P5","M6"],c.scale.scales.minorpentatonic=["P1","m3","P4","P5","m7"],c.scale.scales.chromatic=c.scale.scales.harmonicchromatic=["P1","m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"],c.TeoriaNote=o,c.TeoriaChord=s,c.TeoriaScale=h,c.TeoriaInterval=a,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.teoria=c):"undefined"!=typeof this?this.teoria=c:"undefined"!=typeof window&&(window.teoria=c)}();